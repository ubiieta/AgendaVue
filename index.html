<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Agenda">
        <meta name="author" content="e-ghost 2019">
        <title>AgendaVue-noFireBase</title>

    <!-- Referencia al archivo CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Vue.js (puedes usar CDN si no lo tienes en tu proyecto local) -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>

    <!-- Firebase y Firestore desde CDN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCHTCjVWRmVx_AW6CeKLxoeQGfHvhFMoaI",
            authDomain: "agendavue-7bb62.firebaseapp.com",
            projectId: "agendavue-7bb62",
            storageBucket: "agendavue-7bb62.firebasestorage.app",
            messagingSenderId: "40314208916",
            appId: "1:40314208916:web:c32fb6f2acf6b1bfb02a81"
        };

        // Inicializa Firebase y Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Exporta db para usarlo en Vue
        window.db = db;
    </script>
</head>

<body id="page-top" class="index">
    <div id="app">
        <!-- Header -->
        <header>
            <div class="intro-text">
                <span class="name">MI AGENDA VUE</span>
                <button @click="probarConexion" class="btn btn-primary">Probar Conexión</button>
            </div>
        </header>

        <!-- Sección de Contactos -->
        <section id="contactos">
            <!-- Formulario de añadir contacto -->
            <div class="form-container">
                <form @submit.prevent="agregarContacto">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input v-model="nuevoContacto.nombre" type="text" class="form-control" placeholder="Nombre" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input v-model="nuevoContacto.email" type="email" class="form-control" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <label>Teléfono</label>
                        <input v-model="nuevoContacto.telefono" type="tel" class="form-control" placeholder="Número de teléfono" required>
                    </div>
                    <div class="form-group">
                        <label>Twitter</label>
                        <input v-model="nuevoContacto.twitter" type="text" class="form-control" placeholder="@ de twitter">
                    </div>
                    <br>
                    <button class="btn btn-success btn-lg">Añadir</button>
                </form>
            </div>

            <br><br>

            <!-- Contenedor de la tabla -->
            <div class="table-container">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Email</th>
                            <th>Teléfono</th>
                            <th>Twitter</th>
                            <th>Facebook</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="contacto in contactos" :key="contacto.id">
                            <td>{{ contacto.nombre }}</td>
                            <td>{{ contacto.email }}</td>
                            <td>{{ contacto.telefono }}</td>
                            <td v-html="contacto.twitter"></td>
                            <td>
                                <button class="btn btn-danger btn-sm" @click="borrarContacto(contacto.id)">
                                    <img src="img/eliminar.png" alt="Eliminar" width="20" height="20">
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Vue.js y el código de la app -->
    <script>
        new Vue({
            el: '#app',
            data: {
                contactos: [], // Lista de contactos
                nuevoContacto: {
                    nombre: '',
                    email: '',
                    telefono: '',
                    twitter: ''
                }
            },
            methods: {
                async cargarContactos() {
                    try {
                        // Obtiene los contactos desde Firestore
                        const querySnapshot = await getDocs(collection(window.db, 'contactos'));
                        this.contactos = querySnapshot.docs.map(doc => ({
                            id: doc.id, // ID del documento
                            ...doc.data() // Datos del contacto
                        }));
                    } catch (error) {
                        console.error('Error al cargar los contactos:', error);
                    }
                },
                async agregarContacto() {
                    try {
                        // Crea el enlace de Twitter si es necesario
                        const twitterHandle = this.nuevoContacto.twitter.replace('@', '').trim();
                        const twitterLink = twitterHandle
                            ? `<a class="twitter-follow-button" href="https://twitter.com/${twitterHandle}" target="_blank"></a>`
                            : '';

                        // Añade un nuevo contacto a Firestore
                        await addDoc(collection(window.db, 'contactos'), {
                            nombre: this.nuevoContacto.nombre,
                            email: this.nuevoContacto.email,
                            telefono: this.nuevoContacto.telefono,
                            twitter: twitterLink
                        });

                        // Recarga la lista de contactos
                        this.cargarContactos();

                        // Limpia el formulario
                        this.nuevoContacto = { nombre: '', email: '', telefono: '', twitter: '' };
                    } catch (error) {
                        console.error('Error al agregar el contacto:', error);
                    }
                },
                async borrarContacto(contactoId) {
                    try {
                        // Borra el contacto de Firestore
                        await deleteDoc(doc(window.db, 'contactos', contactoId));

                        // Recarga la lista de contactos
                        this.cargarContactos();
                    } catch (error) {
                        console.error('Error al borrar el contacto:', error);
                    }
                },
                async probarConexion() {
                    try {
                        const querySnapshot = await getDocs(collection(window.db, 'contactos'));
                        console.log('Conexión exitosa. Datos obtenidos:');
                        querySnapshot.forEach(doc => {
                            console.log(doc.id, ' => ', doc.data());
                        });
                        alert('Conexión con Firestore exitosa. Revisa la consola para ver los datos.');
                    } catch (error) {
                        console.error('Error al conectar con Firestore:', error);
                        alert('Error al conectar con Firestore. Verifica la configuración.');
                    }
                }
            },
            mounted() {
                // Carga los contactos cuando la aplicación Vue esté lista
                this.cargarContactos();
            }
        });
    </script>

</body>

</html>
